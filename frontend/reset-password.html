<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Music Platform | Reset lozinke</title>
  <style>
    :root{
      --bg0:#070b16; --bg1:#0b1330; --card:#0c1736;
      --line:#20305f; --line2:#25386d; --text:#eaf1ff; --muted:#a9b7e2;
      --ok:#68d391; --bad:#fc8181; --info:#90cdf4;
      --shadow: 0 14px 40px rgba(0,0,0,.35); --radius: 16px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(79,124,255,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(47,91,255,.14), transparent 55%),
        linear-gradient(135deg, var(--bg0), var(--bg1));
    }
    .container{ max-width: 680px; width:100%; }
    .header{ text-align:center; margin-bottom:18px; }
    .header h1{
      margin:0; font-size:30px;
      background: linear-gradient(135deg, #b8c8ff, #4f7cff 60%, #2f5bff);
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
    }
    .header .subtitle{ margin-top:8px; color:var(--muted); font-size:14px; }

    .alert{
      display:none; padding: 12px 14px; border-radius: 12px; border: 1px solid transparent;
      margin: 0 auto 14px; font-size: 14px;
    }
    .alert.show{ display:block; }
    .alert-success{ background: rgba(104,211,145,.12); border-color: rgba(104,211,145,.28); color: var(--ok); }
    .alert-error{ background: rgba(252,129,129,.10); border-color: rgba(252,129,129,.28); color: var(--bad); }
    .alert-info{ background: rgba(144,205,244,.10); border-color: rgba(144,205,244,.28); color: var(--info); }

    .card{
      background: rgba(12,23,54,.78);
      border: 1px solid var(--line); border-radius: var(--radius);
      padding: 26px; box-shadow: var(--shadow); backdrop-filter: blur(10px);
    }
    .card h2{ margin: 0 0 12px; font-size: 22px; }

    label{
      display:block; margin-bottom: 8px; color: #d7e3ff; font-size: 13px; font-weight: 700;
      letter-spacing:.2px;
    }
    input{
      width:100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--line2);
      background: rgba(7,11,22,.85); color: var(--text); font-size: 15px; outline:none;
      transition: .2s ease;
      margin-bottom: 12px;
    }
    input:focus{ border-color: rgba(79,124,255,.9); box-shadow: 0 0 0 4px rgba(79,124,255,.14); }

    .helper{ margin-top: 6px; font-size: 12px; color: var(--muted); }

    .btn{
      width:100%; padding: 13px 14px; border-radius: 12px;
      border: 1px solid rgba(79,124,255,.7);
      background: linear-gradient(135deg, rgba(79,124,255,.95), rgba(47,91,255,.95));
      color: white; font-size: 15px; font-weight: 800; letter-spacing:.2px;
      cursor:pointer; transition: .2s ease; margin-top: 6px;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 26px rgba(79,124,255,.22); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

    .btn-secondary{
      background: rgba(12,23,54,.65); border-color: var(--line2);
    }
    .btn-secondary:hover{ box-shadow:none; border-color: rgba(79,124,255,.55); }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Music Platform</h1>
      <div class="subtitle">Reset lozinke — postavite novu lozinku</div>
    </div>

    <div id="alertBox" class="alert"></div>

    <div class="card">
      <h2>Nova lozinka</h2>

      <div class="helper" id="tokenInfo"></div>

      <label for="pass1">Nova lozinka</label>
      <input id="pass1" type="password" placeholder="Minimum 8 karaktera" autocomplete="new-password" />

      <label for="pass2">Ponovi novu lozinku</label>
      <input id="pass2" type="password" placeholder="Ponovi lozinku" autocomplete="new-password" />

      <div class="helper">Mora sadržati velika i mala slova i brojeve.</div>

      <button class="btn" id="btnReset">Resetuj lozinku</button>
      <button class="btn btn-secondary" id="btnBack">Nazad na prijavu</button>
    </div>
  </div>

  <script src="/assets/auth.js"></script>
  <script>
    function showAlert(message, type = 'info') {
      const box = document.getElementById('alertBox');
      box.className = `alert alert-${type} show`;
      box.textContent = message;
      setTimeout(() => box.classList.remove('show'), 6500);
    }

    function getTokenFromHash() {
      // očekujemo: reset-password.html#token=XYZ
      const h = (window.location.hash || '').replace(/^#/, '');
      const params = new URLSearchParams(h);
      return (params.get('token') || '').trim();
    }

    const token = getTokenFromHash();
    const tokenInfo = document.getElementById('tokenInfo');
    tokenInfo.textContent = token ? 'Token je učitan iz linka.' : 'Nedostaje token u linku (proveri email).';

    document.getElementById('btnBack').onclick = () => {
      window.location.href = '/user_service.html';
    };

    document.getElementById('btnReset').onclick = async () => {
      if (!token) return showAlert('Token nedostaje u linku.', 'error');

      const btn = document.getElementById('btnReset');
      const p1 = document.getElementById('pass1').value;
      const p2 = document.getElementById('pass2').value;

      if (!p1 || !p2) return showAlert('Popunite oba polja.', 'info');
      if (p1 !== p2) return showAlert('Lozinke se ne poklapaju.', 'error');

      btn.disabled = true;
      const old = btn.textContent;
      btn.textContent = 'Resetujem...';

      try {
        const resp = await MPAuth.resetPassword(token, p1);
        showAlert(resp?.message || 'Lozinka je uspešno resetovana. Sada se prijavite.', 'success');
        // preusmeri na login posle kratko
        setTimeout(() => window.location.href = '/user_service.html', 1200);
      } catch (e) {
        showAlert(e.message || 'Greška pri resetovanju.', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = old;
      }
    };
  </script>
</body>
</html>
